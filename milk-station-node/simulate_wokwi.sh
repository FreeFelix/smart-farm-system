#!/bin/bash

# Milk Station Node - Wokwi Simulation Script
# Simulates a complete milking session with RFID cow identification

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘     MILK STATION NODE - WOKWI SIMULATION                â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ğŸ“‹ SIMULATION OVERVIEW:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "This simulation demonstrates a fixed milking station with:"
echo "  â€¢ RFID cow identification"
echo "  â€¢ Milk flow measurement"
echo "  â€¢ Milk quality monitoring (temperature, pH, conductivity)"
echo "  â€¢ 20x4 LCD display for farmer"
echo "  â€¢ LoRa data transmission"
echo "  â€¢ WiFi connectivity to Device Manager"
echo ""
echo "ğŸ›ï¸  WOKWI COMPONENTS:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "  â€¢ ESP32 DevKit C V4 (main controller)"
echo "  â€¢ DS18B20 Temperature Sensor (milk temperature)"
echo "  â€¢ 20x4 LCD Display with I2C (farmer interface)"
echo "  â€¢ 3 LEDs (Green=OK, Red=Alert, Blue=Boot)"
echo "  â€¢ 2 Potentiometers (pH and conductivity simulation)"
echo "  â€¢ 1 Pushbutton (milk flow pulse simulation)"
echo ""
echo "ğŸ“ PIN CONNECTIONS:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "Temperature Sensor:"
echo "  DS18B20 â†’ GPIO 4 (with 4.7kÎ© pull-up to 3.3V)"
echo ""
echo "LCD Display (I2C):"
echo "  SDA â†’ GPIO 21"
echo "  SCL â†’ GPIO 22"
echo "  Address: 0x27"
echo ""
echo "Status LEDs:"
echo "  Green (Status OK) â†’ GPIO 2 (220Î© resistor)"
echo "  Red (Alert)       â†’ GPIO 27 (220Î© resistor)"
echo "  Blue (Boot)       â†’ GPIO 14 (220Î© resistor)"
echo ""
echo "Milk Sensors:"
echo "  pH Potentiometer        â†’ GPIO 36 (ADC)"
echo "  Conductivity Pot        â†’ GPIO 39 (ADC)"
echo "  Flow Pulse Button       â†’ GPIO 25"
echo ""
echo "LoRa Module (SPI):"
echo "  CS   â†’ GPIO 18"
echo "  SCK  â†’ GPIO 5"
echo "  MOSI â†’ GPIO 23"
echo "  MISO â†’ GPIO 19"
echo "  RST  â†’ GPIO 14"
echo "  DIO0 â†’ GPIO 26"
echo ""
echo "ğŸ¯ SIMULATION SCENARIOS:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "SCENARIO 1: Normal Milking Session"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo "  1. System boots, LCD shows 'Milk Station Ready'"
echo "  2. Green LED ON (system healthy)"
echo "  3. Waiting for RFID cow tag scan"
echo "  4. [Simulated] Cow COW-001 detected"
echo "  5. LCD shows: 'Welcome COW-001'"
echo "  6. Click Flow Button to simulate milk flow"
echo "  7. LCD updates with volume, temperature, pH"
echo "  8. Milk temperature: 4.5Â°C (adjust DS18B20)"
echo "  9. pH: ~6.6 (adjust pH potentiometer)"
echo " 10. Conductivity: normal (adjust conductivity pot)"
echo " 11. Session ends, data transmitted via LoRa/WiFi"
echo ""
echo "SCENARIO 2: Milk Quality Alert"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo "  1. Adjust pH potentiometer to extreme value"
echo "  2. System detects pH < 6.4 or > 6.8"
echo "  3. Red LED blinks (quality alert)"
echo "  4. LCD shows: 'ALERT: Abnormal pH'"
echo "  5. Farmer notification sent"
echo ""
echo "SCENARIO 3: Mastitis Detection"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo "  1. Adjust conductivity potentiometer HIGH"
echo "  2. System detects conductivity > 5.5 mS/cm"
echo "  3. Red LED ON (health alert)"
echo "  4. LCD shows: 'WARNING: High Conductivity'"
echo "  5. Recommendation: 'Check udder health'"
echo ""
echo "ğŸ® INTERACTIVE CONTROLS:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "  DS18B20 Temperature:"
echo "    â€¢ Click on sensor to adjust milk temperature"
echo "    â€¢ Normal range: 2-6Â°C"
echo "    â€¢ Too high â†’ spoilage risk"
echo ""
echo "  pH Potentiometer:"
echo "    â€¢ Rotate to simulate pH changes"
echo "    â€¢ Normal: 6.4-6.8 (mid position)"
echo "    â€¢ Low pH â†’ acidic milk (bad)"
echo "    â€¢ High pH â†’ possible contamination"
echo ""
echo "  Conductivity Potentiometer:"
echo "    â€¢ Rotate to simulate conductivity"
echo "    â€¢ Normal: ~4.5 mS/cm (low-mid position)"
echo "    â€¢ High: >5.5 mS/cm â†’ mastitis indicator"
echo ""
echo "  Flow Pulse Button:"
echo "    â€¢ Click repeatedly to simulate milk flow"
echo "    â€¢ Each click = milk pulse"
echo "    â€¢ Volume calculated from pulse count"
echo ""
echo "ğŸ“Š LCD DISPLAY OUTPUT:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "Line 1: Cow ID or status message"
echo "Line 2: Milk volume (liters)"
echo "Line 3: Temperature and pH"
echo "Line 4: Status or alerts"
echo ""
echo "Example Normal Display:"
echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "â”‚ COW-001  Milking   â”‚"
echo "â”‚ Volume: 12.5 L     â”‚"
echo "â”‚ Temp:4.5C pH:6.6   â”‚"
echo "â”‚ Status: Good       â”‚"
echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "Example Alert Display:"
echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "â”‚ COW-001  ALERT!    â”‚"
echo "â”‚ Volume: 8.2 L      â”‚"
echo "â”‚ Temp:7.2C pH:7.1   â”‚"
echo "â”‚ High Temp & pH!    â”‚"
echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "ğŸ’¡ EXPECTED SERIAL OUTPUT:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "  â€¢ System initialization messages"
echo "  â€¢ LCD display updates"
echo "  â€¢ Sensor readings (temp, pH, conductivity)"
echo "  â€¢ Milk flow rate and volume"
echo "  â€¢ RFID scan status"
echo "  â€¢ LoRa transmission confirmations"
echo "  â€¢ Quality alerts and warnings"
echo ""
echo "ğŸš€ HOW TO RUN SIMULATION:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Method 1: VS Code Wokwi Extension"
echo "  1. Install 'Wokwi Simulator' extension in VS Code"
echo "  2. Open milk-station-node folder"
echo "  3. Press F1 â†’ 'Wokwi: Start Simulator'"
echo "  4. Interact with components in Wokwi window"
echo ""
echo "Method 2: Wokwi CLI"
echo "  1. Build firmware: pio run"
echo "  2. Start Wokwi: wokwi-cli --web"
echo "  3. Open browser to displayed URL"
echo ""
echo "Method 3: Hardware Upload"
echo "  1. Connect ESP32 via USB"
echo "  2. Upload: pio run --target upload"
echo "  3. Monitor: pio device monitor"
echo ""
echo "ğŸ“ TESTING CHECKLIST:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "  â˜ Green LED lights on boot"
echo "  â˜ LCD displays 'Milk Station Ready'"
echo "  â˜ Temperature reading appears (4.5Â°C default)"
echo "  â˜ pH reading displays (adjust potentiometer)"
echo "  â˜ Conductivity reading shows (adjust potentiometer)"
echo "  â˜ Flow button increments milk volume"
echo "  â˜ Red LED alerts on quality issues"
echo "  â˜ LCD updates every 2 seconds"
echo "  â˜ Serial output shows all sensor data"
echo "  â˜ LoRa transmission attempts visible"
echo ""
echo "ğŸ”§ TROUBLESHOOTING:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "Problem: LCD shows nothing"
echo "  â†’ Check I2C address (0x27 or 0x3F)"
echo "  â†’ Verify SDA/SCL connections (GPIO 21/22)"
echo ""
echo "Problem: Temperature always 0Â°C or 85Â°C"
echo "  â†’ Check DS18B20 connections"
echo "  â†’ Verify 4.7kÎ© pull-up resistor"
echo ""
echo "Problem: LEDs not responding"
echo "  â†’ Check GPIO pin numbers in config.h"
echo "  â†’ Verify 220Î© resistors in series"
echo ""
echo "Problem: No LoRa transmission"
echo "  â†’ Check LoRa module SPI connections"
echo "  â†’ Verify frequency (915 MHz)"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Ready to simulate! Build and start Wokwi simulator now."
echo ""
echo "Build command: pio run"
echo "Wokwi start:   Press F1 â†’ 'Wokwi: Start Simulator'"
echo ""
